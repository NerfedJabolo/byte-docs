<!DOCTYPE html>
<html lang='en'>

<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <meta name='description' content='BitJS blog'>

    <title>BitJS: Blog</title>

    <link rel='stylesheet' href='/styles/globals.css'>

    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script defer src='/scripts/snippets.js'></script>
</head>

<body>
    <main>
        <div id='intro'>
            <h1>blitz</h1>
            <p>An important part of a web framework is routing, which might seem simple when you first think about it.
            </p>
        </div>

        <div id='content'>
            <div>
                <h2>The start</h2>

                <p>Here is what my first routing algorithm looked like when I just started building a framework:</p>
                <pre data-snippet='algorithm/first'></pre>

                <p>One problem you can already see here is that this is linear matching algorithm.</p>
                <p>Later on, I improved it into constant time matching for static pathnames.</p>
                <pre data-snippet='algorithm/second'></pre>

                <p>
                    But static path alone is not enough for matching. Popular frameworks
                    include support for URL pattern matching like parameters and wildcards.
                </p>
                <p>
                    So the idiomatic way that I thought about is to match the URL against every single
                    pattern in a pattern list, which have been previously compiled by <code>path-to-regexp</code>.
                </p>
                <pre data-snippet='algorithm/third'></pre>

                <p>
                    This is obviously constant time matching but only for static pathnames.
                    If the path is not in the <code>routesMap</code> it will do linear matching for every pattern.
                </p>

                <h2>Radix tree</h2>
                <p>
                    I was searching for a replacement URL router to use in my framework, which then I found
                    <a href='//github.com/medleyjs/router'><code>@medley/router</code></a>. It could handle URL patterns
                    like above while being at least 5x faster
                    than my solution.
                </p>
                <p>So I took some time trying to understand what is being done under the hood and here's what I found.
                </p>
                <p>
                    The router stores route patterns on a radix tree, but this is a modified radix tree with additional
                    properties to specify URL params and wildcards.
                </p>
                <p>A normal radix tree node looks like this:</p>
                <pre data-snippet='tree/basic-node'></pre>

                <p>And here's the tree nodes that was implemented:</p>
                <pre data-snippet='tree/route-nodes'></pre>
            </div>
        </div>
    </main>
</body>

</html>
